<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Garantia - Real Car Amortecedores</title>
  <style>
    :root {
      --vermelho: #d62828;
      --cinza: #1e1e1e;
      --texto: #f8f9fa;
    }

    body {
      margin: 0;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background-color: var(--cinza);
      color: var(--texto);
      padding: 20px;
    }

    .container {
      max-width: 500px;
      margin: auto;
      background-color: #2a2a2a;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 0 10px #000;
    }

    .logo {
      display: block;
      margin: 0 auto 20px auto;
      max-width: 200px;
    }

    h1 {
      text-align: center;
      color: var(--vermelho);
      font-size: 22px;
    }

    label {
      display: block;
      margin-top: 15px;
      font-weight: bold;
      color: var(--texto);
    }

    input[type="text"], input[type="date"] {
      width: 100%;
      padding: 8px;
      margin-top: 5px;
      border-radius: 5px;
      border: 1px solid #555;
      font-size: 15px;
      background-color: #333;
      color: #f8f9fa;
    }

    .group {
      display: flex;
      flex-wrap: wrap;
      gap: 15px;
      margin-top: 5px;
      font-weight: normal;
    }

    .group input[type="radio"] {
      transform: translateY(1px);
    }

    .extras {
      display: flex;
      gap: 10px;
      margin-top: 10px;
    }

    .extras input[type="text"] {
      height: 38px;
      padding: 8px;
      font-size: 15px;
      border-radius: 5px;
      border: 1px solid #555;
      background-color: #333;
      color: #f8f9fa;
    }

    .extras button {
      width: 40px;
      height: 38px;
      font-size: 18px;
      background: var(--vermelho);
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }

    ul#listaExtras {
      margin-top: 10px;
      padding-left: 20px;
    }

    ul#listaExtras li { font-size: 14px; }

    button {
      width: 100%;
      margin-top: 15px;
      padding: 12px;
      font-size: 16px;
      font-weight: bold;
      background-color: var(--vermelho);
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }

    @media print {
      body {
        background: white;
        color: black;
        font-family: Arial, sans-serif;
      }
      .container, .logo, button {
        display: none !important;
      }
      #printArea {
        display: block !important;
        color: black !important;
        font-size: 15px;
        padding: 20px;
        font-family: Arial, sans-serif;
        white-space: pre-wrap; /* mant√©m as quebras de linha */
      }
    }

    #printArea { display: none; }
  </style>
</head>
<body>
  <div class="container">
    <img src="realcarsemfundo.jpg" alt="Logo Real Car" class="logo" />
    <h1>Garantia de Servi√ßo</h1>

    <label>Ve√≠culo:
      <input type="text" id="veiculo" placeholder="Ex: Corsa Sedan 1.6 2010">
    </label>

    <label>Placa:
      <input type="text" id="placa" placeholder="Ex: ABC1D23">
    </label>

    <label>Amortecedor Dianteiro:</label>
    <div class="group" id="grpDianteiro">
      <label><input type="radio" id="dianteiroDir" name="dianteiro" value="Direito"> Direito</label>
      <label><input type="radio" id="dianteiroEsq" name="dianteiro" value="Esquerdo"> Esquerdo</label>
      <label><input type="radio" id="dianteiroPar" name="dianteiro" value="Par"> Par</label>
    </div>

    <label>Amortecedor Traseiro:</label>
    <div class="group" id="grpTraseiro">
      <label><input type="radio" id="traseiroDir" name="traseiro" value="Direito"> Direito</label>
      <label><input type="radio" id="traseiroEsq" name="traseiro" value="Esquerdo"> Esquerdo</label>
      <label><input type="radio" id="traseiroPar" name="traseiro" value="Par"> Par</label>
    </div>

    <label>Garantia:</label>
    <div class="group" id="grpGarantia">
      <label><input type="radio" id="garantia3m" name="garantia" value="3 meses"> 3 meses</label>
      <label><input type="radio" id="garantia6m" name="garantia" value="6 meses"> 6 meses</label>
      <label><input type="radio" id="garantia1a" name="garantia" value="1 ano"> 1 ano</label>
    </div>

    <label>Data de Venda:
      <input type="date" id="data">
    </label>

    <label>Valor Base:
      <input type="text" id="valorBase" placeholder="Ex: 600,00">
    </label>

    <label>Servi√ßos Extras:</label>
    <div class="extras">
      <input type="text" id="nomeExtra" placeholder="Servi√ßo" style="flex:2;">
      <input type="text" id="valorExtra" placeholder="Valor" style="flex:1;">
      <button type="button" id="btnAdd" onclick="addServicoExtra()">+</button>
    </div>
    <ul id="listaExtras"></ul>

    <label><b>Total:</b>
      <input type="text" id="totalCalculado" readonly>
    </label>

    <label>Telefone do Cliente (com DDD):
      <input type="text" id="telefoneCliente" placeholder="Ex: 83991234567">
    </label>

    <button onclick="imprimir()">üñ®Ô∏è Imprimir Garantia</button>
    <button onclick="enviarWhatsApp()">üì§ Enviar por WhatsApp</button>
  </div>

  <div id="printArea"></div>

  <script>
    let extras = [];

    // ordem EXPL√çCITA dos campos (do come√ßo ao fim)
    function getOrder() {
      return [
        document.getElementById('veiculo'),
        document.getElementById('placa'),
        document.getElementById('dianteiroDir'),
        document.getElementById('dianteiroEsq'),
        document.getElementById('dianteiroPar'),
        document.getElementById('traseiroDir'),
        document.getElementById('traseiroEsq'),
        document.getElementById('traseiroPar'),
        document.getElementById('garantia3m'),
        document.getElementById('garantia6m'),
        document.getElementById('garantia1a'),
        document.getElementById('data'),
        document.getElementById('valorBase'),
        document.getElementById('nomeExtra'),
        document.getElementById('valorExtra'),
        document.getElementById('telefoneCliente'),
      ].filter(Boolean);
    }

    function focusNext(currentEl) {
      const order = getOrder();
      const i = order.indexOf(currentEl);
      if (i > -1 && i < order.length - 1) {
        order[i + 1].focus();
      } else if (i === order.length - 1) {
        currentEl.blur(); // √∫ltimo campo
      }
    }

    window.onload = () => {
      // data default + total
      const hoje = new Date().toLocaleDateString('fr-CA');
      document.getElementById("data").value = hoje;
      calcularTotal();
      document.getElementById("valorBase").addEventListener("input", calcularTotal);

      // ENTER em todos os inputs da ordem definida
      getOrder().forEach((el) => {
        el.addEventListener('keydown', (e) => {
          if (e.key === 'Enter') {
            e.preventDefault();

            if (el.id === 'valorExtra') {
              // adiciona servi√ßo e volta pro nome
              addServicoExtra();
              document.getElementById('nomeExtra').focus();
              return;
            }

            focusNext(el);
          }
        });
      });

      // ENTER no bot√£o "+" tamb√©m adiciona (opcional)
      document.getElementById('btnAdd').addEventListener('keydown', (e) => {
        if (e.key === 'Enter') {
          e.preventDefault();
          addServicoExtra();
          document.getElementById('nomeExtra').focus();
        }
      });
    };

    function formatar(valor) {
      const n = parseFloat(valor);
      if (isNaN(n)) return "0,00";
      return n.toFixed(2).replace('.', ',');
    }

    function addServicoExtra() {
      const nome = document.getElementById("nomeExtra").value.trim();
      const valor = parseFloat(document.getElementById("valorExtra").value.replace(',', '.'));

      if (!nome || isNaN(valor)) return;

      extras.push({ nome, valor });
      document.getElementById("nomeExtra").value = "";
      document.getElementById("valorExtra").value = "";
      renderExtras();
      calcularTotal();
    }

    function renderExtras() {
      const lista = document.getElementById("listaExtras");
      lista.innerHTML = "";
      extras.forEach(e => {
        const li = document.createElement("li");
        li.textContent = `- ${e.nome} (R$ ${formatar(e.valor)})`;
        lista.appendChild(li);
      });
    }

    function calcularTotal() {
      const base = parseFloat(document.getElementById("valorBase").value.replace(',', '.')) || 0;
      const totalExtras = extras.reduce((s, e) => s + e.valor, 0);
      const total = base + totalExtras;
      document.getElementById("totalCalculado").value = total > 0 ? `R$ ${formatar(total)}` : "";
      return formatar(total);
    }

    function gerarTextoGarantia() {
      const veiculo = document.getElementById("veiculo").value || "-";
      const placa = document.getElementById("placa").value || "-";
      const dianteiro = document.querySelector('input[name="dianteiro"]:checked')?.value || "-";
      const traseiro = document.querySelector('input[name="traseiro"]:checked')?.value || "-";
      const garantia = document.querySelector('input[name="garantia"]:checked')?.value || "-";
      const data = document.getElementById("data").value || "-";
      const base = parseFloat(document.getElementById("valorBase").value.replace(',', '.')) || 0;
      const total = calcularTotal();
      const listaServicos = extras.length
        ? extras.map(e => `- ${e.nome} (R$ ${formatar(e.valor)})`).join("\n")
        : "Nenhum";

      // Calcula validade pela garantia
      let validade = "-";
      if (data !== "-") {
        const d = new Date(data);
        if (garantia === "3 meses") d.setMonth(d.getMonth() + 3);
        if (garantia === "6 meses") d.setMonth(d.getMonth() + 6);
        if (garantia === "1 ano") d.setFullYear(d.getFullYear() + 1);
        validade = d.toLocaleDateString('pt-BR');
      }

      return `GARANTIA DE SERVI√áO

Ve√≠culo: ${veiculo}
Placa: ${placa}

Amortecedor Dianteiro: ${dianteiro}
Amortecedor Traseiro: ${traseiro}

Garantia: ${garantia}
Data da Venda: ${data}
Validade at√©: ${validade}

Valor Base: R$ ${formatar(base)}

Servi√ßos Extras:
${listaServicos}

Total: R$ ${total}

-----------------------------
Real Car Amortecedores
Distrito Mec√¢nico - Box 15
Jo√£o Pessoa - PB
(83) 99860-5077
-----------------------------`;
    }

    function imprimir() {
      document.getElementById("printArea").innerText = gerarTextoGarantia();
      setTimeout(() => window.print(), 100);
    }

    // WhatsApp: mensagem institucional (sem os dados da garantia)
    function enviarWhatsApp() {
      let numero = document.getElementById("telefoneCliente").value.trim();
      if (!numero) {
        alert("Informe o n√∫mero do cliente com DDD (ex: 83991234567).");
        return;
      }
      numero = numero.replace(/\D/g, "");
      if (numero.length < 10) {
        alert("N√∫mero inv√°lido. Use DDD + n√∫mero.");
        return;
      }

      const mensagem = encodeURIComponent(
        "Ol√°! Aqui √© da Real Car Amortecedores.\n\n" +
        "Segue abaixo a garantia referente ao servi√ßo realizado no seu ve√≠culo.\n\n" +
        "Real Car Amortecedores\n" +
        "Distrito Mec√¢nico - Box 15\n" +
        "Jo√£o Pessoa - PB\n" +
        "(83) 99860-5077\n\n" +
        "Qualquer d√∫vida, estamos √† disposi√ß√£o!"
      );

      const url = `https://wa.me/55${numero}?text=${mensagem}`;
      window.open(url, "_blank");
    }
  </script>
</body>
</html>
